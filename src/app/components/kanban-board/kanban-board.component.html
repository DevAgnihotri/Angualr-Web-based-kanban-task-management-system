<!-- Kanban Board Header -->
<mat-toolbar color="primary" class="kanban-header">
  <mat-icon>dashboard</mat-icon>
  <span class="header-title">Kanban Task Manager</span>
  <span class="spacer"></span>
  
  <!-- Action Buttons Container -->
  <div class="action-buttons">
    <!-- Add Task Button with Dropdown -->
    <button 
      mat-raised-button 
      color="accent" 
      class="add-task-btn" 
      [matMenuTriggerFor]="addTaskMenu"
      aria-label="Add new task">
      <mat-icon>add</mat-icon>
      Add
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
    
    <!-- Add Task Menu -->
    <mat-menu #addTaskMenu="matMenu" class="add-task-menu">
      <button 
        mat-menu-item 
        *ngFor="let column of columns" 
        (click)="onAddTask(column.id)" 
        class="menu-item"
        [ngClass]="getColumnMenuClass(column)">
        <mat-icon 
          class="menu-icon" 
          [style.color]="column.color">
          {{getColumnIcon(column)}}
        </mat-icon>
        <span>Add to {{column.title}}</span>
      </button>
      
      <!-- Add Column option (only show if less than 4 columns) -->
      <button 
        mat-menu-item 
        *ngIf="columns.length < 4"
        (click)="onAddColumn()" 
        class="menu-item add-column-item">
        <mat-icon class="menu-icon">add_circle_outline</mat-icon>
        <span>Create New Column</span>
      </button>
    </mat-menu>
  </div>
</mat-toolbar>

<!-- Kanban Board Container -->
<div class="kanban-container">
  <div 
    class="kanban-board"
    cdkDropList
    cdkDropListOrientation="horizontal"
    [cdkDropListData]="columns"
    (cdkDropListDropped)="onColumnDrop($event)">
    
    <!-- Loop through each column -->
    <div class="kanban-column" *ngFor="let column of columns" cdkDrag>
      
      <!-- Column Header -->
      <app-column-header 
        [title]="column.title" 
        [taskCount]="getTaskCount(column.id)"
        [status]="column.status"
        [color]="column.color"
        [isCustom]="column.isCustom || false"
        [columnId]="column.id"
        [canDelete]="canDeleteColumn(column)"
        [showDragHandle]="true"
        (deleteColumn)="onDeleteColumn($event)">
      </app-column-header>
      
      <!-- Column Content -->
      <mat-card class="column-card">
        <mat-card-content class="column-content">
          
          <!-- Drop Zone for Tasks -->
          <div 
            class="task-list" 
            [id]="column.id + '-list'"
            cdkDropList
            [cdkDropListData]="column.tasks"
            [cdkDropListConnectedTo]="getConnectedDropLists()"
            (cdkDropListDropped)="onTaskDrop($event)">
            
            <!-- Task Cards -->
            <div *ngFor="let task of column.tasks" class="task-item">
              <div cdkDrag>
                <app-task-card 
                  [task]="task"
                  [isDragging]="false"
                  (editTask)="onEditTask($event)"
                  (deleteTask)="onDeleteTask($event)"
                  (updateTask)="onUpdateTask($event)">
                </app-task-card>
                
                <!-- Custom drag placeholder -->
                <div class="drag-placeholder" *cdkDragPlaceholder>
                  <div class="placeholder-content">
                    <mat-icon>drag_indicator</mat-icon>
                    <span>Drop here</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Placeholder when no tasks -->
            <div *ngIf="column.tasks.length === 0" class="empty-column">
              <mat-icon class="empty-icon">inbox</mat-icon>
              <p class="empty-text">Drop tasks here</p>
            </div>
            
          </div>
          
        </mat-card-content>
      </mat-card>
      
    </div>
    
  </div>
</div>
